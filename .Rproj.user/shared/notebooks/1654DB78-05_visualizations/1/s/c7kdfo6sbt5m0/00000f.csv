"0","data |>"
"0","  select(patient_nbr, race, gender) |>"
"0","  distinct(patient_nbr, .keep_all = TRUE) |>"
"0","  mutate(race = ifelse(is.na(race), ""Other"", race)) |>"
"0","  group_by(race, gender) |>"
"0","  summarise(count = n(), .groups = ""drop"") |>"
"0","  mutate(text_color = ifelse(count > 4000, ""white"", "
"0","                       ifelse(gender == ""Female"", ""hotpink"", "
"0","                        ifelse(gender == ""Male"", ""cornflowerblue"", ""grey35"")))) |>"
"0","  ggplot(aes(x = race, y = count, fill = gender)) +"
"0","  geom_bar(stat = ""identity"", position = ""stack"") +"
"0","  geom_text("
"0","    aes(label = count, color = text_color),"
"0","    data = data |> "
"0","      select(patient_nbr, race, gender) |>"
"0","      distinct(patient_nbr, .keep_all = TRUE) |>"
"0","      mutate(race = ifelse(is.na(race), ""Other"", race)) |>"
"0","      group_by(race, gender) |>"
"0","      summarise(count = n(), .groups = ""drop"") |>"
"0","      filter(count > 4000) |>"
"0","      mutate(text_color = ifelse(count > 4000, ""white"", "
"0","                           ifelse(gender == ""Female"", ""hotpink"", "
"0","                            ifelse(gender == ""Male"", ""cornflowerblue"", ""grey35"")))),"
"0","    position = position_stack(vjust = 0.5),"
"0","    size = 4"
"0","  ) +"
"0","  geom_text("
"0","    aes(label = count, color = text_color),"
"0","    data = data |> "
"0","      select(patient_nbr, race, gender) |>"
"0","      distinct(patient_nbr, .keep_all = TRUE) |>"
"0","      mutate(race = ifelse(is.na(race), ""Other"", race)) |>"
"0","      group_by(race, gender) |>"
"0","      summarise(count = n(), .groups = ""drop"") |>"
"0","      filter(count <= 4000) |>"
"0","      mutate(text_color = ifelse(count > 4000, ""white"", "
"0","                           ifelse(gender == ""Female"", ""hotpink"","
"0","                            ifelse(gender == ""Male"", ""cornflowerblue"", ""grey35"")))),"
"0","    position = position_dodge2(width = 0.8),"
"0","    size = 4,"
"0","    vjust = -3"
"0","  ) +"
"0","  scale_color_identity() +"
"0","  labs("
"0","    x = ""Race"", "
"0","    y = ""Count"", "
"0","    fill = ""Gender"","
"0","    title = str_c(""Gender/race distribution of dataset, total no. of patients: "", "
"0","                  data |> "
"0","                    select(patient_nbr) |>"
"0","                    group_by(patient_nbr) |>"
"0","                    summarise(count = n()) |>"
"0","                    count()"
"0","                  )"
"0","    ) +"
"0","  scale_fill_manual(values = c(""hotpink"", ""cornflowerblue"", ""grey35"")) +"
"0","  theme_minimal() +"
"0","  theme(legend.position = ""bottom"")"
