"0","diabetes_count |>"
"0","  mutate(type = ifelse(str_detect(all_diagnoses,'type I '),'Type I','Type II or unspecified'),"
"0","         uncontrolled = ifelse(str_detect(all_diagnoses,', uncontrolled'), "
"0","                               'Uncontrolled', 'Not specified as uncontrolled'),"
"0","         no_complication = ifelse(str_detect(all_diagnoses, 'without mention of complication'),"
"0","                                  'No complication','Complications')) |>"
"0","  mutate(complication_type = ifelse(no_complication == 'Complications',"
"0","                                    str_to_sentence(str_extract(all_diagnoses,'(?<=with ).*(?=, *type)')),"
"0","                                    'None')) |>"
"0","  mutate(complication_type = ifelse(is.na(complication_type),'Pregnancy complications',complication_type)) |>"
"0","  filter(!complication_type == 'None') |>"
"0","  ggplot(aes(x = uncontrolled, y=count, fill = complication_type)) +"
"0","  geom_bar(stat='identity',) +"
"0","  facet_wrap(~type) +"
"0","  labs(title = 'Diabetes managment and complications',"
"0","       subtitle = str_c("
"0","         'For patients with diabetes as primary or secondary diagnosis\n(only for cases with complications: ',"
"0","                        diabetes_count |>"
"0","                          filter(!str_detect(all_diagnoses, 'without mention of complication')) |>"
"0","                          select(count) |>"
"0","                          sum(),"
"0","                        ' patients)'),"
"0","       x = 'Controllation of disease', "
"0","       y = 'Number of instances', "
"0","       fill = 'Complications') +"
"0","  theme_minimal() +"
"0","  scale_fill_viridis_d(option = 'plasma',direction=-1) + "
"0","  scale_x_discrete(labels = function(x) str_wrap(x,width = 17))"
"0",""
