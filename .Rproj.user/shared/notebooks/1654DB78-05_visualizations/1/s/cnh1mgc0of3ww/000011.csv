"0","data |>"
"0","  select(patient_nbr, number_diagnoses,encounter_id) |>"
"0","  group_by(patient_nbr) |>"
"0","  arrange(encounter_id, .by_group = TRUE) |>"
"0","  mutate(visit_num = row_number()) |>"
"0","  ungroup() |>"
"0","  select(-encounter_id) |>"
"0","  pivot_wider("
"0","    names_from = visit_num,                "
"0","    values_from = number_diagnoses,        "
"0","    names_prefix = ""visit_"",          "
"0","    values_fill = list(number_diagnoses = NA)) |>"
"0","  pivot_longer(cols = c(-patient_nbr),"
"0","               names_to = 'visit',"
"0","               values_to = 'diagnosis') |>"
"0","  drop_na(diagnosis) |>"
"0","  group_by(visit) |>"
"0","  summarise(mean_diagnosis = mean(diagnosis), no_people = n()) |>"
"0","  mutate(visit = str_extract(visit, ""\\d+""),"
"0","         visit = factor(visit,levels=sort(as.numeric(visit)))) |>"
"0","  ggplot(aes(x=visit,y=mean_diagnosis)) +"
"0","  geom_point(aes(color=no_people),size=3) +"
"0","  scale_color_gradient2(low='hotpink',"
"0","                     mid='orange',"
"0","                     high='cornflowerblue',"
"0","                     midpoint=12000,"
"0","                     limits=c(2,NA),"
"0","                     n.breaks=5,"
"0","                     transform = 'sqrt',"
"0","                     na.value = 'forestgreen',"
"0","                     guide = guide_colorbar(title = ""Amount of people"")"
"0","                     ) +"
"0","  theme_minimal() +"
"0","  theme(axis.text.x=element_text(angle=90,hjust=1)) + "
"0","  labs(title = 'Average number of diagnoses by maximum amount of visits by patient',"
"0","       subtitle = '- Green dots signify 1 person',"
"0","       x = 'Maximum amount of visits by patients',"
"0","       y = 'Average number of diagnoses') "
