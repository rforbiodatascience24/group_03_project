"0",""
"0","plot_data <- data |>"
"0","  select(patient_nbr,race,gender) |>"
"0","  distinct(patient_nbr, .keep_all = TRUE) |>"
"0","  mutate(race = ifelse(is.na(race), ""Other"", race)) |>"
"0","  group_by(race, gender) |>"
"0","  summarise(count = n(), .groups = ""drop"") |>"
"0","  mutate(text_color = ifelse(count > 4000, ""white"", "
"0","                             ifelse(gender=='Female','hotpink',"
"0","                                    ifelse(gender=='Male','cornflowerblue','grey35'))))"
"0","  "
"0","ggplot(plot_data, aes(x=race, y=count,"
"0","             fill=gender)) +"
"0","  geom_bar(stat='identity',"
"0","           position = 'stack') +"
"0","   geom_text(data = plot_data |> filter(count > 4000), "
"0","            aes(label = count, color = text_color, vjust = 0.5),"
"0","            position = position_stack(vjust = 0.5),  "
"0","            size = 4) +"
"0",""
"0","  geom_text(data = plot_data |> filter(count <= 4000), "
"0","            aes(label = count, color = text_color, vjust = -3),"
"0","            position = position_dodge2(width=0.8),  "
"0","            size = 4) +"
"0","  scale_color_identity() +"
"0","  labs(x = ""Race"", "
"0","       y = ""Count"", "
"0","       fill = ""Gender"","
"0","      title = str_c('Gender/race distribution of dataset, total no. of patients: ',"
"0","                    sum(plot_data$count))) +"
"0","  scale_fill_manual(values = c('hotpink',"
"0","                               'cornflowerblue',"
"0","                               'grey35')) +"
"0","  theme_minimal() +"
"0","  theme(legend.position = 'bottom')"
