"0","data |>"
"0","  select(patient_nbr, encounter_id, nr_encounters, diag_1_long) |>"
"0","  group_by(diagnosis = diag_1_long) |>"
"0","  summarise(count = n(), .groups = ""drop"") |>"
"0","  top_n(10, count) |>"
"0","  inner_join(data, by = c(""diagnosis"" = ""diag_1_long"")) |>"
"0","  group_by(nr_encounters, diagnosis) |>"
"0","  summarise(diagnosis_count = n(), .groups = ""drop"") |>"
"0","  ggplot(aes(x = nr_encounters, y = diagnosis, fill = diagnosis_count)) +"
"0","  geom_tile(color = ""white"") +"
"0","  scale_fill_gradient(low = ""orange"", high = ""purple"") +"
"0","  scale_y_discrete(labels = function(y) str_wrap(y, width = 45)) +"
"0","  labs("
"0","    x = ""Number of visits"","
"0","    y = """","
"0","    fill = ""Amount of patients"","
"0","    title = ""Top 10 most common primary diagnosis per visit"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme(axis.text.x = element_text(angle = 0, hjust = 1),"
"0","        legend.position = 'bottom',"
"0","        legend.background = element_rect(linewidth = 0.5, color = 'grey'),"
"0","        legend.text = element_text(angle=20,hjust=1),"
"0","        legend.justification = 'left',"
"0","        legend.title.position = 'top',"
"0","        plot.title = element_text(hjust = -3))"
