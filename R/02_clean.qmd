---
title: "Load project data"
format: html
editor: visual
---

## Load libraries

```{r, message=FALSE}
suppressWarnings({
library("tidyverse")
library("here")
library("broom")
})
```

## Clean the meta data

```{r}
suppressWarnings({
#Data is loaded without headers, since the header only corresponds to the first tables header
meta_data <- read.csv(here("data/IDs_mapping.csv"),
                      header=FALSE,
                      na.strings = "")

#Rename columns
meta_data <- meta_data |> 
  rename(type_id = V1, 
         description = V2)

# Remove NA columns and add a column based on admission type, that is numeric. The NA values in this, will be the names of the type of metadata the id describes. Also adds a meta_type column, which has the type in the cells that are NAs in the numeric type_id_as_num
meta_data <- meta_data |> 
  na.omit() |> 
  mutate(type_id, 
         type_id_as_num = as.numeric(type_id)) |> 
  mutate(meta_type = ifelse(is.na(type_id_as_num), 
                            type_id, 
                            NA))

#Fills meta_type with the last non-NA cell 
meta_data <- meta_data |> 
    fill(meta_type)

#Removes the rows containing the names, drops admission_type_is_as_num
meta_data_clean <- meta_data |> 
  filter(!is.na(type_id_as_num)) |> 
  select(!type_id_as_num)

})
```

## Clean diabetes data

```{r}
diabetes_data <- read.csv(here("data/diabetic_data.csv"), 
                          na.strings = c("?", "None"))
diabetes_data 
```

```{r}
#Change NO in readmitted column to No
diabetes_data <- diabetes_data |> 
  mutate(readmitted, 
         readmitted = str_replace(string = readmitted, 
                                  "NO", 
                                  "No"))

#Change Ch in change column to Yes
diabetes_data <- diabetes_data |> 
  mutate(change, 
         change = str_replace(string = change, 
                                  "Ch", 
                                  "Yes"))


```

## Add information from metadata to diabetes data

```{r}

```

## Output clean data

```{r}
write_csv(diabetes_data, here("data/02_dat_clean.csv"))
```

```{r}
read.csv(here("data/02_dat_clean.csv"))
```
